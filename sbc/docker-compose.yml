version: '3.8'

services:
  rtpengine:
    image: sipwise/rtpengine:latest
    container_name: ivr_rtpengine
    networks:
      - ivrnet
    ports:
      - "2223:2223/udp"        # rtpengine control port
      - "12000-12100:12000-12100/udp" # RTP ports for proxying
    command: rtpengine --interface=0.0.0.0 --port-min=12000 --port-max=12100 --log-level=5 --api-addr=0.0.0.0 --api-port=2223 --external-ip=192.168.1.208
    restart: unless-stopped

  kamailio:
    build: ./opensips
    container_name: ivr_kamailio
    depends_on:
      - rtpengine
    networks:
      - ivrnet
    ports:
      - "5062:5060/udp"   # expose Kamailio on host port 5062 so it doesn't clash with Asterisk
    volumes:
      - ./kamailio.cfg:/usr/local/etc/kamailio/kamailio.cfg:ro
    environment:
      - KAMAILIO_CFG=/usr/local/etc/kamailio/kamailio.cfg
    restart: unless-stopped

networks:
  ivrnet:
    external: true
    name: ivrnet
