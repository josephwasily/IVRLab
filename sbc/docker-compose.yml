version: '3.8'

services:
  rtpengine:
    build: ./rtpengine
    container_name: ivr_rtpengine
    networks:
      - ivrnet
    ports:
      - "2223:2223/udp"        # rtpengine control port
      - "12000-12100:12000-12100/udp" # RTP ports for proxying
    command: ["rtpengine", "--foreground", "--interface=0.0.0.0", "--listen-ng=0.0.0.0:2223", "--port-min=12000", "--port-max=12100", "--log-level=5"]
    restart: unless-stopped

  kamailio:
    build: ./opensips
    container_name: ivr_kamailio
    depends_on:
      - rtpengine
    networks:
      - ivrnet
    ports:
      - "5062:5060/udp"   # expose Kamailio on host port 5062 so it doesn't clash with Asterisk
    volumes:
      - ./kamailio.cfg:/usr/local/etc/kamailio/kamailio.cfg:ro
    environment:
      - KAMAILIO_CFG=/usr/local/etc/kamailio/kamailio.cfg
    restart: unless-stopped

networks:
  ivrnet:
    external: true
    name: ivrnet
