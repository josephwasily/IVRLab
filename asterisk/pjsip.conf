[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0
; CRITICAL: Only this container's exact IP is "local"
; The Docker gateway 172.21.0.1 (where Zoiper traffic comes from) must NOT match local_net
; so that external_media_address is applied to RTP for Zoiper
local_net=172.21.0.6/32
external_media_address=192.168.2.31
external_signaling_address=192.168.2.31

; === GLOBAL DEFAULTS ===
; Template for all endpoints to inherit common settings
[endpoint-defaults](!)
type=endpoint
context=from-internal
disallow=all
allow=ulaw
allow=opus
direct_media=no
; DTMF: Use rfc4733 (updated RFC2833) for out-of-band DTMF in RTP
dtmf_mode=rfc4733
; NAT handling - essential for calls through SBC/NAT
rtp_symmetric=yes
rewrite_contact=yes
force_rport=yes
; Prevent RTP timeout during one-way audio (IVR playback)
rtp_timeout=0
rtp_timeout_hold=0
; Session timers - DISABLE to prevent 32-second hangup
timers=no
timers_min_se=90
timers_sess_expires=1800

; === ANONYMOUS ENDPOINT ===
; Handles unauthenticated calls (fallback)
[anonymous](endpoint-defaults)
context=from-internal
aors=anonymous

[anonymous]
type=aor
max_contacts=10

[1001](endpoint-defaults)
type=endpoint
auth=1001
aors=1001

[1001]
type=auth
auth_type=userpass
username=1001
password=1001pass

[1001]
type=aor
max_contacts=1
qualify_frequency=30
qualify_timeout=10
; === AVAYA IP OFFICE SIP TRUNK ===
; Trunk connection from IP Office to Asterisk IVR
[ipoffice](endpoint-defaults)
type=endpoint
context=from-ipoffice
aors=ipoffice
; No auth required for trunk - we identify by IP

[ipoffice]
type=aor
max_contacts=5
qualify_frequency=60

[identify-ipoffice]
type=identify
endpoint=ipoffice
match=192.168.2.211